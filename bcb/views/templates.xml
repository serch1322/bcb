<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Vista Validar Datos -->
    <template id="validar_datos" name="Validar Datos">
        <t t-set="additional_title">Validar Datos</t> <!-- Permite agregar titulo a la pestaña del navegador -->
        <t t-call="website.layout">
            <div id="wrap">
                <div class="container">
                    <div class="row">
                        <div class="col-12">
                            <form action="/validar_datos">
                                <div class="form-group">
                                  <label for="exampleInputPassword1">Validar Rostro</label>
                                  <input type="image" class="img-thumbnail" id="exampleInputPassword1" name="imagen"/>
                                </div>
                                <button type="submit" class="btn btn-primary">Revisar</button>
                              </form>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Vista Listado Clientes -->
    <template id="listado_clientes" name="Listado Clientes">
        <t t-call="website.layout">
            <t t-set="additional_title">Listado Clientes</t>
            <div id="wrap">
                <div class="container">
                    <div class="row mt-5 mb-5">
                        <div class="col-12">
                            <t t-set="breadcrumbs_searchbar" t-value="True"/>
                            <t t-call="portal.portal_searchbar">
                                <t t-set="title">Usuarios</t>
                            </t>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="row text-center">
                                <div class="col-4" t-foreach="usuarios" t-as="u">
                                    <div class="card"  >
                                        <p t-field="u.rostro" style="height:270px" t-options="{'widget':'image'}"/>
                                        <div class="card-body">
                                           <a t-attf-href="/usuario_final/{{ u.id }}"> <h5 class="card-title" t-esc="u.name" /> </a>
                                            <t t-if="u.state == 'limpio'">
                                                <span t-if="u.state == 'limpio'" class="badge badge-pill badge-secondary bg-success">Limpio</span>
                                                <br/>
                                                <br/>
                                            </t>
                                            <t t-if="u.state == 'moroso'">
                                                <span class="badge badge-pill badge-secondary bg-warning">Moroso</span>
                                                <br/>
                                                <br/>
                                            </t>
                                            <t t-if="u.state == 'fraude'">
                                                <span class="badge badge-pill badge-secondary bg-danger">Fraude</span>
                                                <br/>
                                                <br/>
                                            </t>
                                            <a t-attf-href="/usuario_final/{{ u.id }}" class="btn btn-primary">Mas detalles</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-12">
                                    <nav aria-label="Page navigation example">
                                      <ul class="pagination justify-content-center">
                                        <li t-attf-class="page-item #{ 'disabled' if pager['page']['num'] == 1  else '' }">
                                          <a class="page-link" t-att-href="pager['page_previous']['url'] if pager['page']['num'] != 1 else None " tabindex="-1" aria-disabled="true">Anterior</a>
                                        </li>
                                            <t t-foreach="pager['pages']" t-as="page">
                                                <li class="page-item">
                                                    <a class="page-link" t-att-href="page['url']"> <span t-esc="page['num']"/>  </a>
                                                </li>
                                            </t>
                                        <li t-attf-class="page-item #{ 'disabled' if pager['page']['num'] == pager['page_count']  else '' }" >
                                          <a class="page-link" t-att-href="pager['page_next']['url'] if pager['page']['num'] != pager['page_count'] else None ">Siguiente</a>
                                        </li>
                                      </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Vista Usuario Final -->
    <template id="usuario_final" name="Usuario Final">
        <t t-call="website.layout">
            <t t-set="additional_title" t-value="usuario.name"/>
            <div id="wrap">
                <div class="container crear_empresa_nueva">
                    <div class="row">
                        <div class="col-12 text-center">
                            <br/>
                            <h1 t-esc="usuario.name"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-4 text-center">
                            <span>Rostro del Usuario</span>
                            <p t-field="usuario.rostro" t-options="{'widget': 'image','style':'width: 350px;height: 250px'}" />
                        </div>
                        <div class="col-4 text-center">
                            <span>INE Parte Frontal</span>
                            <p t-field="usuario.ine_frontal" t-options="{'widget': 'image','style':'width: 350px;height: 250px'}" />
                        </div>
                        <div class="col-4 text-center">
                            <span>INE Parte Posterior</span>
                            <p t-field="usuario.ine_posterior" t-options="{'widget': 'image','style':'width: 350px;height: 250px'}" />
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 text-center">
                            <strong>Empresas Ligadas a mi Empresa</strong>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 text-center">
                            <br/>
                            <t t-set="bcb_usuario_final_id" t-value="usuario.id"/>
                            <a role="button" class="btn btn-primary btn-block mb8" data-toggle="modal" data-target="#modalcrearempresa" href="#"> Crear Nueva Empresa </a>
                            <br/>
                        </div>
                    </div>
                    <br/>
                    <div class="row">
                        <div class="col-12">
                               <table class="table">
                                  <thead>
                                    <tr>
                                      <th scope="col">Empresa</th>
                                      <th scope="col">RFC</th>
                                      <th scope="col">Estado</th>
                                      <th scope="col">Actualizar Estado de Cliente</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                      <t t-foreach="usuario.empresas" t-as="ue">
                                        <tr>
                                          <td><span t-field="ue.name" domain="[('uid','=', ue.cliente)]"/></td>
                                          <td><span t-field="ue.rfc"/></td>
                                          <td>
                                              <span t-if="ue.state == 'limpio'" class="badge badge-pill badge-secondary bg-success">Limpio</span>
                                              <span t-if="ue.state == 'moroso'" class="badge badge-pill badge-secondary bg-warning">Moroso</span>
                                              <span t-if="ue.state == 'fraude'" class="badge badge-pill badge-secondary bg-danger">Fraude</span>
                                          </td>
                                            <td>
                                                <t t-set="empresa_usuario_id" t-value="ue.id"/>
                                                <a t-if="ue.state == 'limpio'" role="button" class="btn btn-primary btn-block mb8" data-toggle="modal" t-att-data-empresa-usuario="empresa_usuario_id" data-target="#modalaccept" href="#">
                                                    <i class="fa fa-check"/><t t-if="ue.state == 'limpio'">Actualizar Estado de Cliente</t>
                                                </a>
                                            </td>
                                            <!-- Agregar Colores en el Status del Cliente -->
                                            <!-- Boton para Actualizar Estado de Cliente dependiendo de su Status -->
                                            <!-- Agregar Boton para Crear Nuevas Empresas Ligadas -->
                                        </tr>
                                      </t>
                                  </tbody>
                                </table>
                        </div>
                    </div>
                     <!-- Forma para Crear Nueva Empresa -->
                    <div id="quote_content" class="col-12 col-lg justify-content-end">

                        <!-- modal relative to the actions sign and pay -->
                        <div role="dialog" class="modal fade" id="modalcrearempresa">
                            <div class="modal-dialog">
                                <form id="crear_empresa"  method="POST" class="modal-content js_website_submit_form">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    <header class="modal-header">
                                        <h4 class="modal-title">Crear Nueva Empresa</h4>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">×</button>
                                    </header>
                                    <main class="modal-body" id="sign-dialog" t-att-data-bcb-usuario-final="bcb_usuario_final_id">
                                        <p>
                                            <span>Al llenar este formulario, acepta que vinculara al usuario final con la empresa dada de alta:</span>
                                        </p>
                                        <div class="form-group">
                                          <label for="empresa">Empresa</label>
                                          <input type="text" class="form-control" id="empresa" name="empresa" t-att-data-valor-empresa="''"  />
                                        </div>
                                        <div class="form-group">
                                          <label for="rfc">RFC</label>
                                          <input type="text" class="form-control" id="rfc" name="rfc" t-att-data-valor-rfc="''"  />
                                        </div>
                                        <button id="empresa_nueva" type="submit" class="btn btn-primary">Guardar</button>
                                        <button type="cancel" class="btn btn-danger">Cancelar</button>
                                    </main>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Forma para Actualizar Estado de Cliente -->
                    <div id="quote_content" class="col-12 col-lg justify-content-end">

                        <!-- modal relative to the actions sign and pay -->
                        <div role="dialog" class="modal fade" id="modalaccept">
                            <div class="modal-dialog">
                                <form id="accept" method="POST" class="js_accept_json modal-content js_website_submit_form">
                                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                    <header class="modal-header">
                                        <h4 class="modal-title">Actualizar Cliente</h4>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">×</button>
                                    </header>
                                    <main class="modal-body" id="sign-dialog">
                                        <p>
                                            <span>By signing this proposal, I agree to the following terms:</span>
                                            <ul>
                                                <li><span>Accepted on the behalf of:</span></li>
                                            </ul>
                                        </p>
                                        <t t-call="portal.signature_form">
                                            <t t-set="call_url" t-value="''"/>
                                            <t t-set="default_name" t-value="''"/>
                                        </t>
                                    </main>
                                </form>
                            </div>
                        </div>
                    </div><!-- // #quote_content -->

                    <div class="row">
                        <div class="col-12 text-center">
                            <strong>Evidencia de otras Empresas</strong>
                            <br/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                               <table class="table">
                                  <thead>
                                    <tr>
                                      <th scope="col">Empresa</th>
                                      <th scope="col">RFC</th>
                                      <th scope="col">Estado</th>
                                      <th scope="col">Actualizar Estado de Cliente</th>
                                    </tr>
                                  </thead>
                                  <tbody>
                                      <t t-foreach="usuario.empresas" t-as="ue">
                                        <tr>
                                          <td><span t-field="ue.name"/></td>
                                          <td><span t-field="ue.rfc"/></td>
                                          <td>
                                              <span t-if="ue.state == 'limpio'" class="badge badge-pill badge-secondary bg-success">Limpio</span>
                                              <span t-if="ue.state == 'moroso'" class="badge badge-pill badge-secondary bg-warning">Moroso</span>
                                              <span t-if="ue.state == 'fraude'" class="badge badge-pill badge-secondary bg-danger">Fraude</span>
                                          </td>
                                        </tr>
                                      </t>
                                  </tbody>
                                </table>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12 text-center">
                            <br/>
                            <a class="btn btn-primary" href="/listado_clientes"> Regresar </a>
                        </div>
                        <div class="col-12">
                            <br/>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- Crear Empresa de Usuario -->
    <template id="crear_empresa">
        <t t-call="website.layout">
            <t t-set="additional_title">Crear Empresa</t>
            <div id="wrap">
                <div class="container">
                    <div class="row">
                        <div class="col-12">
                            <form action="/usuario_final" method="post" enctype="multipart/form-data" >
                                <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/> <!-- solo para post -->
                                <input type="hidden" name="usuario_id" t-att-value="usuario_final and usuario_final.id"/>
                                <div class="form-group">
                                  <label for="empresa">Empresa</label>
                                  <input type="text" class="form-control" id="empresa" name="empresa" t-att-value="''"  />
                                </div>
                                <div class="form-group">
                                  <label for="rfc">RFC</label>
                                  <input type="text" class="form-control" id="rfc" name="rfc" t-att-value="''"  />
                                </div>
                                <button type="submit" class="btn btn-primary">Guardar</button>
                              </form>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>